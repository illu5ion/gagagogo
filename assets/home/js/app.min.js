var currentPage=0;$(function(){"use strict";$(".gag-container").fitVids(),$(".infinite-scroll").scrollPagination({contentPage:urls.infinite,contentData:{page:function(){return currentPage},type:order.type},scrollTarget:$(window),heightOffset:100,beforeLoad:function(){alertify.log(trans.loading_new_gags)},afterLoad:function(){currentPage+=1,$(".gag-container").fitVids()}}),$(".infinite-scroll, .single-gag, .js-category-paginated").on("click",".clickable-gif, .clickable-vine",function(a){a.preventDefault();var b=$(this).find("a").data("url"),c=$(this).find("a").data("type");if($(this).find("span").hide(),"vine"===c&&($(this).children().remove(),$(this).append('<iframe class="vine-embed" src="https://vine.co/v/'+b+'/embed/simple?audio=1" width="100%" height="540" frameborder="0"></iframe>')),"gif"===c){var d=$(this).find("a").children();if("gif"!==d.attr("src").slice(-3))d.attr("src",b);else{var e=b.replace(".gif",".png").replace("uploads/","uploads/gif_prefix_");d.attr("src",e),$(this).find("span").show()}}}),$(".gag-wrapper, .single-gag, .js-category-paginated").on("click",".upvote, .downvote",function(a){a.preventDefault();{var b=$(this),c=$(this).data("url");$(this).data("type")}b.parent().find("i").removeClass("selected"),b.find("i").addClass("selected"),$.getJSON(c,function(a){"error"===a.status&&(alertify.log(a.message,"error"),b.parent().find("i").removeClass("selected"))})}),$("#sign-in #signin").on("click",function(a){a.preventDefault();var b=$("#sign-in-form").serialize(),c=$(this);$(".alert").css("display","none"),c.button("loading"),$.post(urls.signin,b,function(a){"success"==a.status?(alertify.log(a.message,"success"),$(".alert-success").css("display","block"),$(".alert-success span").text(a.message),location.reload()):(alertify.log(a.message,"error"),$(".alert-danger").css("display","block"),$(".alert-danger span").text(a.message),c.button("reset"))},"json")}),$("#sign-up #signup").on("click",function(a){a.preventDefault();var b=$("#sign-up-form").serialize(),c=$(this);$(".alert").css("display","none"),c.button("loading"),$.post(urls.signup,b,function(a){"success"==a.status?(alertify.log(a.message,"success"),$(".alert-success").css("display","block"),$(".alert-success span").text(a.message),location.reload()):(alertify.log(a.message,"error"),$(".alert-danger").css("display","block"),$(".alert-danger span").text(a.message),c.button("reset"))},"json")}),$("#image-form, #media-form").ajaxForm({dataType:"json",beforeSubmit:function(){$(".alert").css("display","none"),$("#imageSubmit").button("loading"),$("#mediaSubmit").button("loading")},success:function(a){"success"==a.status?(alertify.log(a.message,"success"),$(".alert-success").css("display","block"),$(".alert-success span").text(a.message),window.location.href=a.redirect_to):(alertify.log(a.message,"error"),$(".alert-danger").css("display","block"),$(".alert-danger span").text(a.message),$("#imageSubmit").button("reset"),$("#mediaSubmit").button("reset"))}}),$(".comment-type-selector a").on("click",function(a){a.preventDefault();var b=$(this).data("div-open");$(".app-comments, .facebook-comments").hide(),"app-comments"===b&&$(".app-comments").fadeIn(400),"facebook-comments"===b&&$(".facebook-comments").fadeIn(400)}),setInterval(function(){"loggedIn"===user.authentication_type&&$.ajax({url:urls.notifications,type:"POST",dataType:"html",success:function(a){if(""!==a){var b=$(".notification-bubble").data("notification-amount"),c=$(a).find(".content").length;$(".notification-bubble").data("notification-amount",b+c),$(".notification-bubble").html(b+c),alertify.log(trans.new_notification),$(".notification-container li.error").remove(),$(".notification-container ul").append(a)}}})},1e4),$(".notification-container").on("click",function(){$(".notification-bubble").data("notification-amount",0),$(".notification-bubble").html(0)}),$("#notification-trasher").on("click",function(){var a=$(".notification-container li").map(function(){return $(this).data("notification-id")}).get();0!==a.length&&($.ajax({url:urls.notifications_trash,type:"POST",dataType:"html",data:{"notifications[]":a},success:function(a){""!==a&&alertify.log(a)}}),$(".notification-container li").remove())})});